(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();class d{state;listeners=new Set;MAX_HISTORY=50;constructor(e){this.state={expression:e?.expression||"",currentNumber:e?.currentNumber||"",result:e?.result||null,history:e?.history||[],theme:e?.theme||"system",isDegree:e?.isDegree??!0,isScientific:e?.isScientific??!1}}getState(){return{...this.state,history:[...this.state.history]}}setState(e){this.state={...e},this.notifyListeners()}toggleScientificMode(){this.state.isScientific=!this.state.isScientific,this.notifyListeners()}isScientificMode(){return!!this.state.isScientific}toggleAngleUnit(){this.state.isDegree=!this.state.isDegree,this.notifyListeners()}isDegreeMode(){return this.state.isDegree!==!1}updateExpression(e){this.state.expression=e,this.notifyListeners()}updateCurrentNumber(e){this.state.currentNumber=e,this.notifyListeners()}updateResult(e){this.state.result=e,this.notifyListeners()}updateTheme(e){this.state.theme=e,this.notifyListeners()}addHistory(e){this.state.history=[e,...this.state.history],this.state.history.length>this.MAX_HISTORY&&(this.state.history=this.state.history.slice(0,this.MAX_HISTORY)),this.notifyListeners()}removeHistory(e){this.state.history=this.state.history.filter(t=>t.id!==e),this.notifyListeners()}clearHistory(){this.state.history=[],this.notifyListeners()}reset(){const e=this.state.theme;this.state={expression:"",currentNumber:"",result:null,history:[],theme:e,isDegree:!0,isScientific:!1},this.notifyListeners()}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){const e=this.getState();this.listeners.forEach(t=>{t(e)})}}class f{STORAGE_KEY="calc_app_v1";saveState(e){try{const t=JSON.stringify(e);localStorage.setItem(this.STORAGE_KEY,t)}catch(t){console.error("Failed to save state to localStorage:",t)}}loadState(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(!e)return null;const t=JSON.parse(e);return this.isValidState(t)?t:(console.warn("Invalid state data in localStorage"),null)}catch(e){return console.error("Failed to load state from localStorage:",e),null}}clearState(){try{localStorage.removeItem(this.STORAGE_KEY)}catch(e){console.error("Failed to clear state from localStorage:",e)}}isValidState(e){if(!e||typeof e!="object")return!1;const t=["expression","currentNumber","result","history","theme"];for(const s of t)if(!(s in e))return!1;return!(typeof e.expression!="string"||typeof e.currentNumber!="string"||e.result!==null&&typeof e.result!="string"||!Array.isArray(e.history)||!["light","dark","system"].includes(e.theme))}}class y{calculate(e){const t=this.tokenize(e),s=this.infixToPostfix(t);return this.evaluatePostfix(s)}tokenize(e){const t=e.replace(/\s+/g,""),s=[];let r="";for(let i=0;i<t.length;i++){const n=t[i];this.isDigit(n)||n==="."?r+=n:(this.isOperator(n)||n==="("||n===")")&&(r&&(s.push(r),r=""),s.push(n))}return r&&s.push(r),s}infixToPostfix(e){const t=[],s=[];for(const r of e)if(this.isNumber(r))t.push(r);else if(r==="(")s.push(r);else if(r===")"){for(;s.length>0&&s[s.length-1]!=="(";)t.push(s.pop());if(s.length===0)throw new Error("Í¥ÑÌò∏Í∞Ä ÎßûÏßÄ ÏïäÏäµÎãàÎã§");s.pop()}else if(this.isOperator(r)){for(;s.length>0&&this.getPrecedence(s[s.length-1])>=this.getPrecedence(r);)t.push(s.pop());s.push(r)}for(;s.length>0;){const r=s.pop();if(r==="("||r===")")throw new Error("Í¥ÑÌò∏Í∞Ä ÎßûÏßÄ ÏïäÏäµÎãàÎã§");t.push(r)}return t}evaluatePostfix(e){const t=[];for(const s of e)if(this.isNumber(s))t.push(parseFloat(s));else if(this.isOperator(s)){if(t.length<2)throw new Error("ÏûòÎ™ªÎêú ÏàòÏãùÏûÖÎãàÎã§");const r=t.pop(),i=t.pop(),n=this.applyOperator(i,r,s);t.push(n)}if(t.length!==1)throw new Error("ÏûòÎ™ªÎêú ÏàòÏãùÏûÖÎãàÎã§");return t[0]}factorial(e){if(e<0)return NaN;if(e===0||e===1)return 1;let t=1;for(let s=2;s<=e;s++)t*=s;return t}calculatePercent(e,t){const s=parseFloat(e);if(isNaN(s))return"0";if(t){const r=parseFloat(t);return isNaN(r)?(s/100).toString():(r*(s/100)).toString()}return(s/100).toString()}calculateScientificFunction(e,t,s=!0){switch(e){case"sin":return Math.sin(this.toRadian(t,s));case"cos":return this.fixPrecision(Math.cos(this.toRadian(t,s)));case"tan":return this.fixPrecision(Math.tan(this.toRadian(t,s)));case"asin":return this.toDegree(Math.asin(t),s);case"acos":return this.toDegree(Math.acos(t),s);case"atan":return this.toDegree(Math.atan(t),s);case"log":return Math.log10(t);case"ln":return Math.log(t);case"exp":return Math.exp(t);case"sqrt":if(t<0)throw new Error("ÏùåÏàòÏùò Ï†úÍ≥±Í∑ºÏùÄ ÌóàÏàòÏûÖÎãàÎã§");return Math.sqrt(t);case"cbrt":return Math.cbrt(t);case"pow2":return Math.pow(t,2);case"inv":if(t===0)throw new Error("0ÏúºÎ°ú ÎÇòÎàå Ïàò ÏóÜÏäµÎãàÎã§");return 1/t;case"abs":return Math.abs(t);case"fact":return this.factorial(t);default:throw new Error(`ÏßÄÏõêÌïòÏßÄ ÏïäÎäî Ìï®Ïàò: ${e}`)}}toRadian(e,t){return t?e*Math.PI/180:e}toDegree(e,t){return t?e*180/Math.PI:e}fixPrecision(e){return Math.abs(e)<1e-10?0:e}isDigit(e){return/\d/.test(e)}isOperator(e){return["+","-","*","/"].includes(e)}isNumber(e){return!isNaN(parseFloat(e))&&isFinite(parseFloat(e))}getPrecedence(e){return e==="+"||e==="-"?1:e==="*"||e==="/"?2:0}applyOperator(e,t,s){switch(s){case"+":return e+t;case"-":return e-t;case"*":return e*t;case"/":if(t===0)throw new Error("0ÏúºÎ°ú ÎÇòÎàå Ïàò ÏóÜÏäµÎãàÎã§");return e/t;default:return 0}}}class l{static VALID_CHARS=/^[0-9+\-*/().]$/;static OPERATORS=["+","-","*","/"];static isValidInput(e){return this.VALID_CHARS.test(e)}static isValidExpression(e){if(!e||e.trim()==="")return!1;for(const s of e.replace(/\s/g,""))if(!this.isValidInput(s))return!1;const t=e.trim();return!this.OPERATORS.includes(t)}static canAddOperator(e,t){if(!e||e.trim()==="")return!1;const s=e.trim(),r=s[s.length-1];return!(this.OPERATORS.includes(r)||r==="."||r==="(")}static canAddDecimal(e){if(!e||e.trim()==="")return!0;const s=e.trim().split(/[\+\-\*\/\(\)]/);return!s[s.length-1].trim().includes(".")}static canAddParenthesis(e,t){if(t==="(")return!0;const s=(e.match(/\(/g)||[]).length,r=(e.match(/\)/g)||[]).length;return s>r}static hasBalancedParentheses(e){let t=0;for(const s of e)if(s==="(")t++;else if(s===")"&&(t--,t<0))return!1;return t===0}}class b{currentTheme;STORAGE_KEY="calc_theme";constructor(){this.currentTheme=this.loadTheme(),this.applyTheme(this.currentTheme),this.setupSystemThemeListener()}loadTheme(){const e=localStorage.getItem(this.STORAGE_KEY);return e==="light"||e==="dark"||e==="system"?e:"system"}saveTheme(e){localStorage.setItem(this.STORAGE_KEY,e)}applyTheme(e){this.shouldUseDarkMode(e)?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}shouldUseDarkMode(e){return e==="dark"?!0:e==="light"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches}setupSystemThemeListener(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{this.currentTheme==="system"&&this.applyTheme("system")})}setTheme(e){this.currentTheme=e,this.saveTheme(e),this.applyTheme(e)}getTheme(){return this.currentTheme}toggleTheme(){const e=this.shouldUseDarkMode(this.currentTheme)?"light":"dark";this.setTheme(e)}isDarkMode(){return this.shouldUseDarkMode(this.currentTheme)}}class u{static formatNumber(e){if(!e||e===""||isNaN(Number(e)))return e;const t=e.split("."),s=t[0],r=t[1],i=s.startsWith("-"),o=(i?s.slice(1):s).replace(/\B(?=(\d{3})+(?!\d))/g,","),c=i?"-"+o:o;return r!==void 0?`${c}.${r}`:c}static formatDecimal(e,t=10){const s=parseFloat(e);return isNaN(s)||Number.isInteger(s)?e:s.toFixed(t).replace(/\.?0+$/,"")}static removeTrailingZeros(e){return e.includes(".")?e.replace(/(\.\d*?)0+$/,"$1").replace(/\.$/,""):e}static formatResult(e){if(e==="Infinity"||e==="-Infinity")return e;if(e==="NaN")return"Error";const t=parseFloat(e);if(isNaN(t))return e;if(Math.abs(t)<1e-6&&t!==0||Math.abs(t)>1e15)return t.toExponential(6);let s=this.formatDecimal(t.toString(),10);return s=this.removeTrailingZeros(s),s=this.formatNumber(s),s}}class g{container;expressionElement;currentNumberElement;constructor(e){this.container=e,this.expressionElement=document.createElement("div"),this.currentNumberElement=document.createElement("div"),this.render()}render(){this.container.innerHTML="",this.container.className="calc-display",this.expressionElement.className="display-expression",this.expressionElement.textContent="¬†",this.currentNumberElement.className="display-number",this.currentNumberElement.textContent="0",this.container.appendChild(this.expressionElement),this.container.appendChild(this.currentNumberElement)}updateExpression(e){this.expressionElement.textContent=e||"¬†"}updateCurrentNumber(e){if(!e||e===""){this.currentNumberElement.textContent="0";return}const t=u.formatNumber(e);this.currentNumberElement.textContent=t}updateResult(e){const t=u.formatResult(e);this.currentNumberElement.textContent=t}clear(){this.expressionElement.textContent="¬†",this.currentNumberElement.textContent="0"}showError(e){this.currentNumberElement.textContent=e,this.currentNumberElement.classList.add("text-error"),setTimeout(()=>{this.currentNumberElement.classList.remove("text-error")},2e3)}}class E{container;panel;historyList;isOpen=!1;onHistoryClick;onHistoryDelete;onClearAll;constructor(e,t,s,r){this.container=e,this.onHistoryClick=t,this.onHistoryDelete=s,this.onClearAll=r,this.panel=document.createElement("div"),this.historyList=document.createElement("div"),this.render()}render(){this.panel.className="history-panel-side";const e=document.createElement("div");e.className="history-header",e.innerHTML=`
            <h2 class="history-title">History</h2>
        `;const t=document.createElement("button");t.textContent="Ï†ÑÏ≤¥ ÏÇ≠Ï†ú",t.className="history-clear-btn",t.addEventListener("click",s=>{s.stopPropagation(),this.onClearAll()}),this.historyList.className="history-list-container",e.querySelector("#close-history")?.addEventListener("click",()=>{this.close()}),this.panel.appendChild(e),this.panel.appendChild(t),this.panel.appendChild(this.historyList),this.container.appendChild(this.panel)}updateHistory(e){if(this.historyList.innerHTML="",e.length===0){const t=document.createElement("div");t.style.padding="32px",t.style.textAlign="center",t.style.color="var(--color-text-secondary)",t.textContent="Í≥ÑÏÇ∞ Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§",this.historyList.appendChild(t);return}e.forEach(t=>{const s=this.createHistoryItem(t);this.historyList.appendChild(s)})}createHistoryItem(e){const t=document.createElement("div");t.className="history-panel-item fade-in";const s=document.createElement("div");s.style.fontSize="14px",s.style.color="var(--color-text-secondary)",s.textContent=e.expression;const r=document.createElement("div");r.style.fontSize="18px",r.style.fontWeight="600",r.style.color="var(--color-text)",r.textContent=`= ${u.formatResult(e.result)}`;const i=document.createElement("button");return i.innerHTML="üóëÔ∏è",i.className="history-delete-btn",i.setAttribute("aria-label","Delete item"),i.addEventListener("click",n=>{n.stopPropagation(),this.onHistoryDelete(e.id)}),t.appendChild(i),t.appendChild(s),t.appendChild(r),t.addEventListener("click",()=>{this.onHistoryClick(e)}),t}open(){this.isOpen=!0,this.panel.classList.add("open")}close(){this.isOpen=!1,this.panel.classList.remove("open")}toggle(){this.isOpen?this.close():this.open()}getIsOpen(){return this.isOpen}}class S{state;engine;themeManager;display;historyPanel;keypadContainer;keypadSection;constructor(e){this.state=e,this.engine=new y,this.themeManager=new b,this.initUI(),this.state.subscribe(t=>{this.updateUI(t)}),this.setupKeyboardListeners(),this.updateUI(this.state.getState()),this.setupPanelSync()}initUI(){const e=document.querySelector("#app");e.innerHTML="",e.setAttribute("role","application"),e.setAttribute("aria-label","Scientific Calculator");const t=document.createElement("div");t.className="calc-scientific-section",e.appendChild(t),this.createScientificPanel(t);const s=document.createElement("div");s.className="calc-main-content";const r=this.createHeader();s.appendChild(r);const i=document.createElement("section");i.className="calc-display-section",this.display=new g(i),s.appendChild(i);const n=document.createElement("div");n.style.height="20px",n.style.flexShrink="0",s.appendChild(n),s.appendChild(this.createKeypadSection()),e.appendChild(s);const o=document.createElement("div");o.className="calc-history-section",e.appendChild(o),this.historyPanel=new E(o,c=>{this.state.updateExpression(""),this.state.updateCurrentNumber(c.result)},c=>{this.state.removeHistory(c)},()=>{this.state.clearHistory()})}createHeader(){const e=document.createElement("header");e.className="calc-header";const t=document.createElement("button");t.innerHTML=this.themeManager.isDarkMode()?"‚òÄÔ∏è":"üåô",t.setAttribute("aria-label","Toggle Theme"),t.title="Toggle Theme",t.addEventListener("click",()=>{this.themeManager.toggleTheme(),t.innerHTML=this.themeManager.isDarkMode()?"‚òÄÔ∏è":"üåô"});const s=document.createElement("button");s.id="sci-mode-btn",s.textContent="Scientific",s.setAttribute("aria-label","Toggle Scientific Mode"),s.title="Toggle Scientific Mode",s.style.cssText="width: auto; padding: 0 12px; border-radius: 20px; font-size: 14px; font-weight: 600;",s.addEventListener("click",()=>{this.state.toggleScientificMode(),this.updateScientificButtonState(s)});const r=document.createElement("button");r.id="angle-unit-btn",r.textContent="RAD | DEG",r.setAttribute("aria-label","Toggle Angle Unit"),r.title="Toggle Angle Unit (DEG/RAD)",r.style.cssText="width: auto; padding: 0 12px; font-size: 14px; font-weight: 600; min-width: 80px;",r.addEventListener("click",()=>{this.state.toggleAngleUnit()});const i=document.createElement("button");i.innerHTML="üïí",i.setAttribute("aria-label","View History"),i.title="View History",i.addEventListener("click",()=>{this.historyPanel.toggle();const m=this.historyPanel.getIsOpen(),h=document.body;m?h.classList.add("history-mode-active"):h.classList.remove("history-mode-active")});const n=document.createElement("button");n.innerHTML="?",n.setAttribute("aria-label","Project README"),n.title="View Project GitHub",n.addEventListener("click",()=>{window.open("https://github.com/yonghwan-ko02/calculator-demo","_blank")});const o=document.createElement("div");o.style.width="20px";const c=document.createElement("div");return c.style.width="8px",e.appendChild(t),e.appendChild(document.createElement("div")).style.width="20px",e.appendChild(s),e.appendChild(r),e.appendChild(o),e.appendChild(i),e.appendChild(c),e.appendChild(n),e}createScientificPanel(e){const t=document.createElement("div");t.className="scientific-panel",t.id="scientific-panel",[{value:"asin",label:"sin‚Åª¬π",aria:"ÏïÑÌÅ¨ ÏÇ¨Ïù∏"},{value:"acos",label:"cos‚Åª¬π",aria:"ÏïÑÌÅ¨ ÏΩîÏÇ¨Ïù∏"},{value:"atan",label:"tan‚Åª¬π",aria:"ÏïÑÌÅ¨ ÌÉÑÏ††Ìä∏"},{value:"e",label:"e",aria:"ÏûêÏó∞ÏÉÅÏàò e"},{value:"ln",label:"ln",aria:"ÏûêÏó∞Î°úÍ∑∏"},{value:"exp",label:"eÀ£",aria:"ÏßÄÏàò Ìï®Ïàò"},{value:"cbrt",label:"‚àõ",aria:"ÏÑ∏Ï†úÍ≥±Í∑º"},{value:"inv",label:"1/x",aria:"Ïó≠Ïàò"},{value:"abs",label:"|x|",aria:"Ï†àÎåìÍ∞í"},{value:"fact",label:"x!",aria:"Ìå©ÌÜ†Î¶¨Ïñº"}].forEach(r=>{const i=document.createElement("button");i.className="calc-button calc-button-function",i.textContent=r.label,i.setAttribute("aria-label",r.aria),i.dataset.value=r.value,i.addEventListener("click",()=>this.handleButtonClick(r.value)),t.appendChild(i)}),e.appendChild(t)}updateScientificButtonState(e){const t=this.state.isScientificMode();e.style.backgroundColor=t?"var(--color-primary)":"transparent",e.style.color=t?"#FFFFFF":"var(--color-text-secondary)"}createKeypadSection(){const e=document.createElement("section");return e.className="calc-keypad-section",this.keypadSection=e,this.keypadContainer=document.createElement("div"),this.keypadContainer.className="calc-keypad-grid",[{value:"sin",label:"sin",type:"function",aria:"ÏÇ¨Ïù∏"},{value:"cos",label:"cos",type:"function",aria:"ÏΩîÏÇ¨Ïù∏"},{value:"tan",label:"tan",type:"function",aria:"ÌÉÑÏ††Ìä∏"},{value:"log",label:"log",type:"function",aria:"ÏÉÅÏö©Î°úÍ∑∏"},{value:"sqrt",label:"‚àö",type:"function",aria:"Ï†úÍ≥±Í∑º"},{value:"pow",label:"x¬≤",type:"function",aria:"Ï†úÍ≥±"},{value:"pi",label:"œÄ",type:"function",aria:"ÌååÏù¥"},{value:"percent",label:"%",type:"function",aria:"ÌçºÏÑºÌä∏"},{value:"AC",label:"AC",type:"clear",aria:"Ïò¨ ÌÅ¥Î¶¨Ïñ¥"},{value:"(",label:"(",type:"operator",aria:"Ïó¨Îäî Í¥ÑÌò∏"},{value:")",label:")",type:"operator",aria:"Îã´Îäî Í¥ÑÌò∏"},{value:"/",label:"√∑",type:"operator",aria:"ÎÇòÎàÑÍ∏∞"},{value:"7",label:"7",type:"number",aria:"7"},{value:"8",label:"8",type:"number",aria:"8"},{value:"9",label:"9",type:"number",aria:"9"},{value:"*",label:"√ó",type:"operator",aria:"Í≥±ÌïòÍ∏∞"},{value:"4",label:"4",type:"number",aria:"4"},{value:"5",label:"5",type:"number",aria:"5"},{value:"6",label:"6",type:"number",aria:"6"},{value:"-",label:"-",type:"operator",aria:"ÎπºÍ∏∞"},{value:"1",label:"1",type:"number",aria:"1"},{value:"2",label:"2",type:"number",aria:"2"},{value:"3",label:"3",type:"number",aria:"3"},{value:"+",label:"+",type:"operator",aria:"ÎçîÌïòÍ∏∞"},{value:"0",label:"0",type:"number",aria:"0"},{value:".",label:".",type:"number",aria:"ÏÜåÏàòÏ†ê"},{value:"backspace",label:"‚å´",type:"operator",aria:"ÏßÄÏö∞Í∏∞"},{value:"=",label:"=",type:"equals",aria:"Í≥ÑÏÇ∞"}].forEach(s=>{const r=document.createElement("button");r.className=`calc-button calc-button-${s.type}`,r.textContent=s.label,r.setAttribute("aria-label",s.aria),r.dataset.value=s.value,r.setAttribute("tabindex","0"),r.addEventListener("click",()=>{this.handleButtonClick(s.value)}),this.keypadContainer.appendChild(r)}),e.appendChild(this.keypadContainer),e}handleButtonClick(e){try{switch(e){case"AC":this.state.updateExpression(""),this.state.updateCurrentNumber(""),this.state.updateResult(null);break;case"backspace":this.handleBackspace();break;case"=":this.handleEquals();break;case"+":case"-":case"*":case"/":this.handleOperator(e);break;case".":this.handleDecimal();break;case"(":case")":this.handleParenthesis(e);break;case"percent":this.handlePercent();break;case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"log":case"ln":case"sqrt":case"cbrt":case"exp":case"abs":case"fact":case"pow":case"inv":this.handleScientificFunction(e);break;case"pi":this.state.updateCurrentNumber(Math.PI.toString());break;case"e":this.state.updateCurrentNumber(Math.E.toString());break;default:isNaN(Number(e))||this.handleNumber(e);break}}catch{this.display.showError("Ïò§Î•ò")}}handleScientificFunction(e){const t=this.state.getState().currentNumber;if(t)try{const s=parseFloat(t),r=this.state.isDegreeMode();let i=e;e==="pow"&&(i="pow2");const n=this.engine.calculateScientificFunction(i,s,r);this.state.updateCurrentNumber(n.toString())}catch{this.display.showError("Ïò§Î•ò")}}handleNumber(e){const s=this.state.getState().currentNumber+e;this.state.updateCurrentNumber(s)}handleOperator(e){const t=this.state.getState();if(!l.canAddOperator(t.expression+t.currentNumber,e))return;const s=t.expression+t.currentNumber+" "+e+" ";this.state.updateExpression(s),this.state.updateCurrentNumber("")}handleDecimal(){const e=this.state.getState().currentNumber;l.canAddDecimal(e)&&this.state.updateCurrentNumber(e===""?"0.":e+".")}handleParenthesis(e){const t=this.state.getState(),s=t.expression+t.currentNumber;l.canAddParenthesis(s,e)&&(e==="("?(this.state.updateExpression(t.expression+t.currentNumber+"("),this.state.updateCurrentNumber("")):(this.state.updateExpression(t.expression+t.currentNumber+")"),this.state.updateCurrentNumber("")))}handleEquals(){const e=this.state.getState(),t=e.expression+e.currentNumber;if(t.trim())try{const r=this.engine.calculate(t).toString(),i={id:Date.now(),expression:t,result:r,timestamp:Date.now()};this.state.addHistory(i),this.state.updateResult(r),this.state.updateExpression(""),this.state.updateCurrentNumber(r)}catch(s){this.display.showError(s.message)}}handleBackspace(){const e=this.state.getState();e.currentNumber?this.state.updateCurrentNumber(e.currentNumber.slice(0,-1)):e.expression&&this.state.updateExpression(e.expression.trim().slice(0,-1).trim()+" ")}handlePercent(){const e=this.state.getState(),t=e.currentNumber;if(!t)return;const s=e.expression.trim().match(/(\d+(?:\.\d+)?)\s*[\+\-\*\/]\s*$/),r=s?s[1]:void 0;try{const i=this.engine.calculatePercent(t,r);this.state.updateCurrentNumber(i)}catch{this.display.showError("Ïò§Î•ò")}}updateUI(e){this.display.updateExpression(e.expression),this.display.updateCurrentNumber(e.currentNumber),this.historyPanel.updateHistory(e.history);const t=document.querySelector("#angle-unit-btn");if(t){const n=this.state.isDegreeMode();t.innerHTML=n?'<span style="opacity:0.5">RAD</span> | <span style="opacity:1">DEG</span>':'<span style="opacity:1">RAD</span> | <span style="opacity:0.5">DEG</span>'}const s=document.querySelector("#sci-mode-btn");this.updateScientificButtonState(s);const r=document.querySelector(".calc-keypad-section"),i=document.body;r&&(this.state.isScientificMode()?(r.classList.add("scientific-mode"),i.classList.add("scientific-mode-active")):(r.classList.remove("scientific-mode"),i.classList.remove("scientific-mode-active")))}setupPanelSync(){const e=document.querySelector(".calc-scientific-section");if(!this.keypadSection||!e)return;const t=()=>{const r=this.keypadSection.offsetHeight;r>0&&(e.style.height=`${r}px`)};requestAnimationFrame(t),new ResizeObserver(()=>{t()}).observe(this.keypadSection),window.addEventListener("resize",t)}setupKeyboardListeners(){document.addEventListener("keydown",e=>{const t=e.key;t>="0"&&t<="9"?this.handleNumber(t):["+","-","*","/"].includes(t)?this.handleOperator(t):t==="Enter"?this.handleEquals():t==="Backspace"?this.handleBackspace():t==="Escape"?(this.state.updateExpression(""),this.state.updateCurrentNumber(""),this.state.updateResult(null)):t==="."?this.handleDecimal():t==="("||t===")"?this.handleParenthesis(t):t.toLowerCase()==="t"?this.themeManager.toggleTheme():t.toLowerCase()==="h"&&this.historyPanel.toggle()})}}function p(){const a=new f,e=a.loadState(),t=e?new d(e):new d,s=new S(t);t.subscribe(r=>{a.saveState(r)}),window.calculator={uiManager:s,state:t,storage:a},console.log("‚úÖ Í≥µÌïôÏö© Í≥ÑÏÇ∞Í∏∞ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å"),console.log("üí° ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§:"),console.log("  - Ïà´Ïûê/Ïó∞ÏÇ∞Ïûê: ÏßÅÏ†ë ÏûÖÎ†•"),console.log("  - Enter: Í≥ÑÏÇ∞ (=)"),console.log("  - Backspace: Ìïú Í∏ÄÏûê ÏÇ≠Ï†ú"),console.log("  - Escape: Ï†ÑÏ≤¥ ÏÇ≠Ï†ú (AC)"),console.log("  - H: ÌûàÏä§ÌÜ†Î¶¨ Ìå®ÎÑê ÌÜ†Í∏Ä"),console.log("  - T: ÌÖåÎßà ÌÜ†Í∏Ä")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",p):p();
